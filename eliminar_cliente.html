<!DOCTYPE html> 
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Eliminar Cliente</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .floating-btn { position: fixed; bottom: 20px; right: 20px; z-index: 999; }
    #foto-error { display: none; }
  </style>
</head>
<body>
  <div class="container mt-5">
    <h2 class="text-center mb-4">Eliminar Cliente</h2>
    <form class="shadow p-4 rounded bg-light" onsubmit="event.preventDefault(); enviarFormulario();">
      <div class="mb-3">
        <label for="codigo" class="form-label">C√≥digo del Cliente:</label>
        <input type="text" class="form-control" id="codigo" required oninput="buscarCliente()">
      </div>
      <div class="mb-3">
        <label for="nombre" class="form-label">Nombre del Cliente:</label>
        <input type="text" class="form-control" id="nombre" disabled>
      </div>
      <div class="mb-3">
        <label for="ruta" class="form-label">Ruta (Solo n√∫meros, m√°ximo 3 caracteres):</label>
        <input type="text" class="form-control" id="ruta" maxlength="3" pattern="\d{1,3}" required>
      </div>
      <div class="mb-3">
        <label for="motivo" class="form-label">Motivo de Cierre:</label>
        <input type="text" class="form-control" id="motivo" required>
      </div>
      <div class="mb-3">
        <label for="foto" class="form-label">Subir Foto (m√°x. 10MB, solo .jpg):</label>
        <input type="file" class="form-control" id="foto" accept="image/jpeg" onchange="validarFoto()" required>
        <small id="foto-error" class="form-text text-danger">‚ö†Ô∏è Solo se permite archivos .jpg y hasta 10MB.</small>
      </div>
      <button type="submit" class="btn btn-danger w-100">üóëÔ∏è Eliminar</button>
    </form>
  </div>
  <a href="index.html" class="btn btn-secondary floating-btn">‚¨ÖÔ∏è Volver</a>

  <script>
    const URL_SCRIPT_UPLOAD = "https://script.google.com/macros/s/AKfycbzBV4s5BR0193DiAUDF6fR2ZgJ53MM8PhNwITtXVyOPyBb6mzyPxRUeEDnZ_94oaWI-tw/exec"; // URL de tu Apps Script

    // Funci√≥n para buscar el nombre del cliente seg√∫n el c√≥digo
    function buscarCliente() {
      const codigo = document.getElementById("codigo").value;
      if (codigo) {
        fetch('clientes.json')
          .then(response => response.json())
          .then(data => {
            const cliente = data.find(c => c.codigo === codigo);
            if (cliente) {
              document.getElementById("nombre").value = cliente.nombre;
            } else {
              document.getElementById("nombre").value = "Cliente no encontrado";
            }
          })
          .catch(error => {
            alert("‚ùå Error al buscar cliente: " + error);
          });
      }
    }

    // Funci√≥n para validar el archivo de la foto
    function validarFoto() {
      const foto = document.getElementById('foto');
      const error = document.getElementById('foto-error');
      const file = foto.files[0];
      if (file) {
        if (file.size > 10 * 1024 * 1024 || !file.name.endsWith('.jpg')) {
          error.style.display = 'block';
          foto.value = ''; // Limpiar el campo si el archivo no es v√°lido
        } else {
          error.style.display = 'none';
        }
      }
    }

    // Funci√≥n para enviar el formulario
    function enviarFormulario() {
      const codigo = document.getElementById("codigo").value;
      const nombre = document.getElementById("nombre").value;
      const ruta = document.getElementById("ruta").value;
      const motivo = document.getElementById("motivo").value;
      const foto = document.getElementById("foto").files[0];

      if (!codigo || !nombre || !ruta || !motivo || !foto) {
        alert("‚ö†Ô∏è Por favor completa todos los campos.");
        return;
      }

      const reader = new FileReader();
      reader.onloadend = function () {
        // Convertir la imagen a base64
        const base64Foto = reader.result.split(',')[1]; // eliminar el encabezado base64
        const data = {
          codigo: codigo,
          nombre: nombre,
          ruta: ruta,
          motivo: motivo,
          foto: base64Foto
        };

        // Enviar los datos al Google Apps Script
        fetch(URL_SCRIPT_UPLOAD, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
          if (data.status === 'ok') {
            alert("‚úÖ Cliente eliminado correctamente. Foto guardada en Google Drive.");
            // Limpiar formulario despu√©s de enviar
            document.getElementById("codigo").value = "";
            document.getElementById("nombre").value = "";
            document.getElementById("ruta").value = "";
            document.getElementById("motivo").value = "";
            document.getElementById("foto").value = "";
          } else {
            alert("‚ùå Error al guardar los datos.");
          }
        })
        .catch(error => {
          alert("‚ùå Error al enviar los datos: " + error);
        });
      };
      reader.readAsDataURL(foto); // Leer la imagen como base64
    }
  </script>
</body>
</html>




