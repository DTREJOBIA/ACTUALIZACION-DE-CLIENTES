<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Crear Cliente Nuevo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
 <style>
    html, body {
        height: 100%;
        margin: 0;
        background-image: url('fondo5.jpg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        /* Esta es la l√≠nea que necesitas a√±adir */
        background-attachment: fixed;
        display: flex;
        flex-direction: column;
        color: rgb(8, 0, 0);
    }

    .container {
        flex: 1;
    }
    .readonly {
        background-color: #f8f9fa;
        border: 2px dashed #adb5bd;
        color: #495057;
        font-style: italic;
    }
    .completo {
        background-color: #d4edda !important;
        border: 2px solid #28a745 !important;
        color: #155724 !important;
        font-weight: bold;
    }
    footer {
        background-color: #000;
        padding: 20px;
        color: white;
        text-align: center;
    }

    .footer-content {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
    }

    .footer-left-img {
        max-height: 40px;
    }

    footer p {
        margin: 0;
    }

    #foto-error {
        display: none;
    }

    .form-control[type="file"] {
        background-image: url('https://upload.wikimedia.org/wikipedia/commons/4/4e/Upwards_arrow.svg');
        background-repeat: no-repeat;
        background-position: center left;
        background-size: 20px;
        padding-left: 30px;
    }

</style>

    <script>
        function obtenerCoordenadas() {
            const inputLat = document.getElementById("coordenadas");
            inputLat.value = "";

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const latLon = position.coords.latitude + "," + position.coords.longitude;
                    inputLat.value = latLon;
                    inputLat.classList.add("completo");
                }, function(error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: '‚ö†Ô∏è No se pudieron obtener las coordenadas. Verifica que el GPS est√© activo.',
                        confirmButtonText: 'Entendido'
                    });
                    console.error("Geolocation error:", error);
                }, {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                });
            } else {
                Swal.fire({
                    icon: 'warning',
                    title: '¬°Advertencia!',
                    text: '‚ùå La geolocalizaci√≥n no es compatible con este navegador.',
                    confirmButtonText: 'Entendido'
                });
            }
        }

        async function enviarFormulario() {
            const ruta = document.getElementById("ruta").value.trim();
            const nombre = document.getElementById("nombre").value.trim();
            const direccion = document.getElementById("direccion").value.trim();
            const semana = document.getElementById("semana").value;
            const dia = document.getElementById("dia").value;
            const id = document.getElementById("id").value.trim();
            const rtn = document.getElementById("rtn").value.trim();
            const telefono = document.getElementById("telefono").value.trim();
            const coordenadas = document.getElementById("coordenadas").value.trim();
            const foto = document.getElementById("foto").files[0]; // Obtener el archivo de la foto


            if (!ruta || !nombre || !direccion || !semana || !dia || !id || !coordenadas ) {
                Swal.fire({
                    icon: 'warning',
                    title: '¬°Atenci√≥n!',
                    text: '‚ö†Ô∏è Por favor completa todos los campos obligatorios.',
                    confirmButtonText: 'Entendido'
                });
                return;
            }

            const [latitud, longitud] = coordenadas.split(",");

             // Validar la foto si se seleccion√≥
        if (!foto) {
    Swal.fire({
        icon: 'warning',
        title: 'Foto Requerida',
        text: '‚ö†Ô∏è Por favor, sube una foto en formato .jpg.',
        confirmButtonText: 'Entendido'
    });
    return;
}

if (foto.size > 10 * 1024 * 1024 || !foto.name.endsWith('.jpg')) {
    Swal.fire({
        icon: 'error',
        title: 'Error',
        text: '‚ö†Ô∏è Solo se permiten archivos .jpg de hasta 10MB.',
        confirmButtonText: 'Entendido'
    });
    return;
}



            let base64Foto = '';
            if (foto) {
                const reader = new FileReader();
                // Convertir la foto a Base64
                base64Foto = await new Promise((resolve, reject) => {
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(foto);
                });
            }


            fetch('https://script.google.com/macros/s/AKfycbzOK91YKY0Ns-fQhIiR6YPrsQFicsegR_SGBfPaQaMudzFjYuGAyjAniSPle-9DLoW2og/exec', { // Aseg√∫rate de que esta URL es correcta
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    ruta: ruta,
                    nombre: nombre,
                    direccion: direccion,
                    semana: semana,
                    dia: dia,
                    id: id,
                    rtn: rtn,
                    telefono: telefono,
                    latitud: latitud,
                    longitud: longitud,
                    foto: base64Foto // Enviar la foto en Base64
                })
            })
            .then(() => {
                Swal.fire({
                    icon: 'success',
                    title: '¬°Excelente!',
                    text: '‚úÖ Cliente creado exitosamente.',
                    confirmButtonText: 'Aceptar'
                }).then(() => {
                    document.querySelector("form").reset();
                    document.getElementById("coordenadas").classList.remove("completo");
                });
            })
            .catch((error) => {
                Swal.fire({
                    icon: 'error',
                    title: '¬°Error!',
                    text: '‚ùå Error al enviar los datos: ' + error,
                    confirmButtonText: 'Entendido'
                });
            });
        }

        function refrescarFormulario() {
            window.location.reload();
        }

        const rutasValidas = [
            101, 102, 106, 104, 105, 109, 113, 116, 136, 138, 139, 145, 158, 159, 160,
            165, 166, 167, 168, 171, 184, 185, 186, 537, 546, 551, 552, 501, 506, 509,
            511, 512, 518, 519, 527, 528, 529, 547, 563, 526, 561, 564, 119, 123, 127, 141, 142, 144 ,131, 133, 504, 505, 508, 510, 514, 515, 523, 533, 535, 562
        ];

        function validarRuta(input) {
            const valor = input.value.trim();
            const mensaje = document.getElementById("mensajeRuta");

            if (valor === "") {
                input.classList.remove("is-invalid", "is-valid");
                mensaje.style.display = "none";
                return;
            }

            const numero = parseInt(valor);
            const esValida = rutasValidas.includes(numero) && valor.length === 3;

            if (esValida) {
                input.classList.remove("is-invalid");
                input.classList.add("is-valid");
                mensaje.style.display = "none";
            } else {
                input.value = "";
                input.classList.add("is-invalid");
                input.classList.remove("is-valid");
                mensaje.style.display = "block";
            }
        }
    </script>
</head>

<body>
    <div class="container mt-5">
        <h2 class="text-center mb-4">Crear Cliente Nuevo</h2>
        <form class="shadow p-4 rounded bg-light" onsubmit="event.preventDefault(); enviarFormulario();">


            <div class="mb-3">
                <label for="ruta" class="form-label">Ruta:</label>
                <input type="number" class="form-control" id="ruta" name="ruta" required onblur="validarRuta(this)">
                <div class="invalid-feedback" id="mensajeRuta" style="display: none;">
                    ‚ö†Ô∏è Ruta inv√°lida. Ingresa de nuevo la ruta
                </div>
            </div>


            <div class="mb-3">
                <label for="nombre" class="form-label">Nombre del Cliente:</label>
                <input type="text" class="form-control" id="nombre" required>
            </div>

            <div class="mb-3">
                <label for="direccion" class="form-label">Direcci√≥n:</label>
                <input type="text" class="form-control" id="direccion" required>
            </div>

            <div class="mb-3">
                <label for="semana" class="form-label">Semana de Visita:</label>
                <select class="form-select" id="semana" required>
                    <option value="">Selecciona una semana</option>
                    <option value="semana1">Semana1</option>
                    <option value="semana2">Semana2</option>
                    <option value="semana3">Semana3</option>
                    <option value="semana4">Semana4</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="dia" class="form-label">D√≠a de Visita:</label>
                <select class="form-select" id="dia" required>
                    <option value="">Selecciona un d√≠a</option>
                    <option value="Lunes">Lunes</option>
                    <option value="Martes">Martes</option>
                    <option value="Mi√©rcoles">Mi√©rcoles</option>
                    <option value="Jueves">Jueves</option>
                    <option value="Viernes">Viernes</option>
                    <option value="S√°bado">S√°bado</option>
                    <option value="Domingo">Domingo</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="id" class="form-label">N√∫mero de Identidad:</label>
                <input type="text" class="form-control" id="id" maxlength="13" required oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 13);">
            </div>


            <div class="mb-3">
                <label for="rtn" class="form-label">RTN (opcional):</label>
                <input type="text" class="form-control" id="rtn" maxlength="14" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 14);">
            </div>

            <div class="mb-3">
                <label for="telefono" class="form-label">Tel√©fono (opcional):</label>
                <input type="tel" class="form-control" id="telefono" maxlength="8" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 8);">
            </div>

             <div class="mb-3">
                <label for="foto" class="form-label">Subir Foto RTN:</label>
                <input type="file" class="form-control" id="foto" accept="image/jpeg"  >
                <small id="foto-error" class="form-text text-danger">‚ö†Ô∏è Solo se permite archivos .jpg y hasta 10MB.</small>
            </div>

            <div class="mb-3">
                <label for="coordenadas" class="form-label">Coordenadas (Latitud, Longitud):</label>
                <input type="text" class="form-control" id="coordenadas" readonly
                       style="background-color: #ced4da; border: 2px dashed #6c757d;">
            </div>

         

          <button onclick="window.location.href='MAPA_COORD.html'" class="btn btn-primary">
  Ir al Mapa
</button>
            <button type="button" class="btn btn-info w-100" onclick="obtenerCoordenadas()">üìç Obtener Coordenadas</button>
            <button type="submit" class="btn btn-primary w-100 mt-3">üì§ Enviar</button>
            <button type="button" class="btn btn-warning w-100 mt-2" onclick="refrescarFormulario()">üîÑ Refrescar</button>
        </form>
    </div>

    <footer>
        <div class="footer-content">
            <img src="bia_logo.png" alt="Logo Izquierdo" class="footer-left-img">
            <p>¬© 2025 BIA HONDURAS ‚Ä¢ Todos los derechos reservados</p>
        </div>
    </footer>
</body>
</html>


